# –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ Supabase

## üîß –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å **–µ–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ Supabase Auth –¥–ª—è:
- ‚úÖ –û–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç)
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–∞–¥–º–∏–Ω–∫–∞)

–î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **—Ä–æ–ª—å—é** –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üöÄ –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:3001/user-auth
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   - **Email**: admin@iwanna.com
   - **–ü–∞—Ä–æ–ª—å**: admin123 (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π)
   - **–ò–º—è**: Admin
3. –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –®–∞–≥—É 2

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard: https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Users**
4. –ù–∞–∂–º–∏—Ç–µ **Add user** ‚Üí **Create new user**
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Email**: admin@iwanna.com
   - **Password**: admin123
   - **Auto Confirm User**: ‚úÖ (–≥–∞–ª–æ—á–∫–∞)
6. –ù–∞–∂–º–∏—Ç–µ **Create user**

---

## üîê –®–∞–≥ 2: –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å `admin` –≤ –µ–≥–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

### –ß–µ—Ä–µ–∑ SQL Editor –≤ Supabase:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** –≤ Supabase Dashboard
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –ù–∞–π–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
SELECT id, email, raw_user_meta_data 
FROM auth.users 
WHERE email = 'admin@iwanna.com';

-- –î–æ–±–∞–≤—å—Ç–µ —Ä–æ–ª—å admin –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_USER_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
UPDATE auth.users
SET raw_user_meta_data = raw_user_meta_data || '{"role": "admin"}'::jsonb
WHERE email = 'admin@iwanna.com';

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–æ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞
SELECT id, email, raw_user_meta_data 
FROM auth.users 
WHERE email = 'admin@iwanna.com';
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤ `raw_user_meta_data`:
```json
{
  "name": "Admin",
  "role": "admin"
}
```

---

## ‚úÖ –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:3001/user-auth
2. –í–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
   - **Email**: admin@iwanna.com
   - **–ü–∞—Ä–æ–ª—å**: admin123
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É: http://localhost:3001/adminko
4. –ï—Å–ª–∏ –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ - –≤—ã —É–≤–∏–¥–∏—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å! üéâ

---

## üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

```typescript
// –í AuthContext
const isAdmin = user?.user_metadata?.role === 'admin' || false

// –í ProtectedRoute
if (!isAdmin) {
  // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
}
```

### –¢–∏–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

| –¢–∏–ø | –†–æ–ª—å | –î–æ—Å—Ç—É–ø |
|-----|------|--------|
| **–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** | –Ω–µ—Ç —Ä–æ–ª–∏ | –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (`/profile`) |
| **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** | `role: "admin"` | –ê–¥–º–∏–Ω–∫–∞ (`/adminko`) + –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç |

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞—Ç—å —Ä–æ–ª—å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ email:

```sql
-- –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-—Ç—Ä–∏–≥–≥–µ—Ä
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger AS $$
BEGIN
  -- –ï—Å–ª–∏ email = admin@iwanna.com, –Ω–∞–∑–Ω–∞—á–∞–µ–º —Ä–æ–ª—å admin
  IF NEW.email = 'admin@iwanna.com' THEN
    NEW.raw_user_meta_data = 
      COALESCE(NEW.raw_user_meta_data, '{}'::jsonb) || 
      '{"role": "admin"}'::jsonb;
  END IF;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- –°–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  BEFORE INSERT ON auth.users
  FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ admin@iwanna.com –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

---

## üéØ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å:
- ‚úÖ –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Supabase Auth

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ - –ø—Ä–æ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –®–∞–≥ 2 –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π! üöÄ
